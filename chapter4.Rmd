---
output: pdf_document
---
#Chapter 4: Simulation Study of Quantile Regression
##4.1 Simulation of observation from linear model  
Let linear regression model with one independent variable is    
        \begin{equation}
           y = \beta_0 + \beta_1 x + \epsilon
        \end{equation}
To generate N observation from above linear model, we have two methods.   

###4.1.1 First method   
1. Fix parameters $\beta_0$, $\beta_1$ say $\hat{\beta_0}$ and $\hat{\beta_1}$. 
2. Fix independent variable x having N obseravations.
3. Generate N observations from $N(0, \sigma^2)$ with fixed $\sigma^2$ say $\hat{\sigma^2}$.
4. Inser values of $\beta_0, \beta_1$, x and $\epsilon$ to get N observations of y.   

###4.1.2 Second Method  
y can also be generated by simply noting that y ~ $N(\beta_0 + \beta_1 x, \sigma^2)$. Hence when $\beta_0, \beta_1$, x and $\sigma^2$ are fixed, distribution of y becomes known. Generate N observations from N($\hat{\beta_0} + \hat{\beta_1} x$, $\hat{\sigma^2}$).   
**Remark**: Generating observations from linear model (1) will be the same from both the methods provided seed value for generating observations from normal distribution is same.   

###4.1.3 Example    
Let's fix $\beta_0$ = 5, $\beta_1$ = .5 and standard deviation for error distribution i.e. $\sigma$ = 10, 50, 100, 200.   
In generating observations from linear model if $|\beta_0 + \beta_1 x|$ >> |error term|, then we have scatter plot in which data lies on a straight line similar to 1st plot of figure 1. If $|\beta_0 + \beta_1 x|$  << |error term|, then scatter plot looks like 3rd and 4th plot of figure 1 and if $|\beta_0 + \beta_1 x| \simeq$   |error term| then we scatter plot similar to 2nd of figure 1.
Above idea can be generalized to generate observations from multiple linear regression model. Suppose multiple linear regression model is 
  \begin{equation}
  y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 +....... + \beta_p x_p. 
  \end{equation}
Fix $\beta_0, \beta_1, ........, \beta_p$ and $x_1, x_2,......., x_p$. Generate error terms from $N(0, \sigma^2)$ and plug in these values in (2) to get y.

```{r, echo = FALSE, fig.height = 15, fig.width = 15}
setwd("~/Documents/courseProject")
source("linRegSim.R")
x <- seq(3, 3000, by = 3)
beta0 <- 5
beta1 <- .5
data1 <- linRegSim(x, beta0, beta1, 10)
data2 <- linRegSim(x, beta0, beta1, 50)
data3 <- linRegSim(x, beta0, beta1, 100)
data4 <- linRegSim(x, beta0, beta1, 200)
par(mfrow = c(2, 2))
plot(data1[, 1], data1[, 4], col = "red", xlab = "x", ylab = "y", main = expression(paste(sigma, " = 10")))
plot(data2[, 1], data2[, 4], col = "red", xlab = "x", ylab = "y", main = expression(paste(sigma, " = 50")))
plot(data3[, 1], data3[, 4], col = "red", xlab = "x", ylab = "y", main = expression(paste(sigma, " = 100")))
plot(data4[, 1], data4[, 4], col = "red", xlab = "x", ylab = "y", main = expression(paste(sigma, " = 200")))
```
$$
 \begin{aligned}
 \text{Figure 1. Scatter plot of observations simulated from } y = \beta_0 + \beta_1 x + \epsilon
 \end{aligned}
$$

##4.2 Simulating the Distribution of the Dependent Dariable   
Suppose for linear model in (1) y ~ $N(\beta_0 + \beta_1 x, \sigma^2)$ . Distribution of y for given x, $\beta_0$, $\beta_1$ and $\sigma^2$(say $x_1$, $\hat{\beta_0}$, $\hat{\beta_1}$ and $\hat{\sigma^2}$ respectively) is $N(\hat{\beta_0} + \hat{\beta_1} x_1, \hat{\sigma^2})$. Quantile regression can be used to get the conditional distribution of y for given x. Idea is to fit quantile regression model to get various quantiles of y for given x. To get density one can kernel density estimates of y.
\begin{equation}
    Q_\tau(y|X) = \beta_0(\tau) + \beta_1(\tau) x_1 + .......... + \beta_p(\tau) x_p
\end{equation}
Having x and y we will fit quantile regression model (3). To decide $\tau$, one can take 100 observations from U(0, 1) or choose $\tau$ = 0.02, 0.03, .........., 0.98. It seems reasonable to take $\tau$ = 0.02, 0.03, ......, 0.98 as drawing 100 observations from U(0, 1) may lead most of observations around .5 or .7 or even .1(very low probability). By fixing $\tau$ = 0.02, 0.03, ........., 0.98 we will get 2%, 3%, .........., 98% of y for given x. Now having these percentile points one can use kernel density estimates to get conditional density of y. Some frequently used kernels are:  
```{r, echo = FALSE}
suppressPackageStartupMessages(library(quantreg))
suppressPackageStartupMessages(library(pander))
```
--------------------------------
 Kernel         Kernel Function K(z)  
-------------- -----------------
Rectangular        $\frac{1}{2}I(|z| < 1)$  
Triangular         $(1 - |z|)I(|z| < 1)$
Epanechnikov       $\frac{3}{4}(1 - z^2) I(|z| < 1)$
Tri-cube          $\frac{70}{81}(1 - z^3)^3 I(|z| < 1)$   
  
Gaussian          $\frac{1}{\sqrt{2 \pi}} e^{- z^2/2}$
-------------------------------     

where $I(|z| < 1)$ = 1, if -1 $\leq$ z $\leq$ 1 and 0 otherwise.

```{r, echo = FALSE, fig.width = 15, fig.height = 15}
source("condQuantDensEst.R")
densEst1 <- densEst(x, beta0, beta1, 10, 9)
densEst2 <- densEst(x, beta0, beta1, 10, 60)
densEst3 <- densEst(x, beta0, beta1, 10, 300)
densEst4 <- densEst(x, beta0, beta1, 10, 3000)
par(mfrow = c(2, 2))
plot(densEst1$quantDens, col = "forestgreen", main = "x = 9")
legend("topright", legend = c("quantEstimate", "Actual"), fill = c("forestgreen", "red"))
lines(densEst1$linDens, col = "red")
plot(densEst2$quantDens, col = "forestgreen", main = "x = 60")
lines(densEst2$linDens, col = "red")
plot(densEst3$quantDens, col = "forestgreen", main = "x = 300")
lines(densEst3$linDens, col = "red")
plot(densEst4$quantDens, col = "forestgreen", main = "x = 3000")
lines(densEst4$linDens, col = "red")
```



```{r, echo = FALSE, warning=FALSE}
densEst5 <- densEst(x, beta0, beta1, 10, 60)
densEst6 <- densEst(x, beta0, beta1, 10, 60, kernel = "epane")
densEst7 <- densEst(x, beta0, beta1, 10, 60, kernel = "rect")
densEst8 <- densEst(x, beta0, beta1, 10, 60, kernel = "trian")
plotColor <- rainbow(4)
plot(densEst5$quantDens, col = plotColor[1], main = "Density estimate using various kernel methods", xlab = "Observations")
lines(densEst6$quantDens, col = plotColor[2])
lines(densEst7$quantDens, col = plotColor[3])
lines(densEst8$quantDens, col = plotColor[4])
legend("topright", legend = c("gaussian", "epanechnikov", "rectangular", "triangular"), fill = c(plotColor[1], plotColor[2], plotColor[3], plotColor[4]))
```
   
##4.3 Censored Quantile Regression     
It has already been discussed that parameters $\underline{\beta}$ in the model 
\begin{equation}
  \underline{y} = X\underline{\beta} + \underline{\epsilon}
\end{equation}
is obtained by minimizing the objective function with respect to $\underline{b}$   

\begin{equation}
  S(\underline{\beta}) = \sum_{i = 1}^{n} \rho_{\tau}(y_i - \underline{x_{i}^{'}} \underline{\beta})
\end{equation}
where for $\tau$ $\in$ [0, 1], $\rho_\tau$ is cost function for model(4) defined as 

\begin{equation}
\rho_\tau(u) = u(\tau - I(u < 0))
\end{equation}
i.e.  
$$
\rho_{\tau}(u) = \left\{
        \begin{array}{ll}
            u\tau &, if \quad u \geq 0 \\
            u(\tau - 1) &, if \quad u < 0
        \end{array}
    \right.
$$ 
We have covatiates $X_1, X_2, ......., X_p$ and Y as response variable, n observations are available for model fitting. Model(4) is special case for general response model 
\begin{equation}
  \underline{y} = f(X, \underline{\beta}) + \underline{\epsilon}
\end{equation}
when $f(X, \underline{\beta})$ = X$\underline{\beta}$, in this case quantile regression estimate of $\hat{\underline{\beta}}$ is obtained by minimizing the objective function w.r.t. $\underline{b}$    
$$
 \begin{aligned}
 S(\underline{\beta}) &= \sum_{i = 1}^{n} \rho_{\tau}(y_i - f(\underline{x_{i}}, \underline{b}))
 \end{aligned}
$$
when $f(\underline{x_{i}}, \underline{b})$ = $\underline{x_{i}^{'}}\underline{b}$, then estimate $\hat{\underline{\beta(\tau)}}$ is called $\tau^{th}$ linear quantile regression estimate of $\beta(\tau)$.    

###4.3.1 Cox and Censored Regression Quantile   
If we have response variable(random) {$Y_i$, i = 1, 2, ......, n}, then the pairs {($Y_i$, $X_i$)} constitutes a multivariate iid sample of size n. Let $f_i$ and $F_i$ be conditional density and cdf of $Y_i$. But suppose censoring is present in data and censoring times are {$C_i$, i = 1, 2, ......., n}. Assume that $C_i$ and $Y_i$ are independent but $C_i$ and $x_i$ may be dependent. Define the censored random variables as   
\begin{equation}
\widetilde{Y_{i}} = min\{Y_{i}, C_{i}\}
\end{equation}
and censoring indicator by
\begin{equation}
  \bigtriangleup_{i} = I(Y_{i} \leq C_{i})
\end{equation}
where I is indicator function. Now triples{($Y_i$, $C_i$, $\bigtriangleup_{i}$)} constitute the random sample.   
For censored survival times **Cox's proprtional hazard model** read as 
\begin{equation}
  h_{i}(t) = -\frac{d}{dt}log S_{i}(t)
\end{equation}
where $h_{i}(t)$ is the hazard rate at time t of the $i^{th}$ individual, and $S_{i}(t)$ is the survival function i.e. $S_{i}(t)$ = 1 - $F_{i}(t)$. Proportional hazard model says the unique effect of a unit increase in a covariate multiplicative with respect to hazard rate i.e. 
\begin{equation}
  h_{i}(t) = h_{0}(t) e^{\underline{x_{i}^{'}} \underline{\beta}}
\end{equation}
for i = 1, 2, .........., n.    
where $h_{0}(t)$ is the **baseline hazard function** i.e. hazard function when $x_i$ =  0(absence of covariates). From (10) and (11)   

$$
 \begin{aligned}
    \frac{d}{dt}log S_{i} (t) &= -h_{0}(t) e^{\underline{x_{i}^{'}} \underline{\beta}} \\
    log S_{i}(t) &= - \int_{0}^{t} h_{0}(s) e^{\underline{x_{i}^{'}} \underline{\beta}} dt \\
    &= -e^{\underline{x_{i}^{'}} \underline{\beta}} H_{0}(t) \\
    \text{where }  H_{0}(t) = \int_{0}^{t} h_{0}(s) ds \\
    S_{i}(t) &= exp\{ -H_{0}(t) e^{\underline{x_{i}^{'}} \underline{\beta}}\}
 \end{aligned}
$$
To get $\tau_{th}$ conditional quantile, Let 

$$
 \begin{aligned}
  F_{i}(t) &= \tau \\
  \text{i.e. } 1 - S_{i}(t) &= \tau \\
  \text{i.e. } S_{i}(t) &= 1 - \tau \\
  exp\{-H_{0}(t) e^{\underline{x_{i}^{'}} \underline{\beta}} \} &= 1 - \tau \\
  H_{0}(t) e^{\underline{x_{i}^{'}} \underline{\beta}} &= - log(1 - \tau) \\
  H_{0}(t) &= - e^{\underline{x_{i}^{'}} \underline{\beta}} log(1 - \tau) \\ 
  \text{i.e. } t &=  H_{0}^{-1} [- e^{\underline{x_{i}^{'}} \underline{\beta}} log(1 - \tau) ]
 \end{aligned}
$$
i.e. 

\begin{equation}
  Q_{\tau}(y|x) = H_{0}^{-1} [- e^{\underline{x_{i}^{'}} \underline{\beta}} log(1 - \tau) ] 
\end{equation}
**Remark:** From (12) it is clear that conditional quantile function is not linear in $\underline{\beta}$. Koenker and Geling(2001) suggest one local measure for the regression coefficient $\underline{\beta}$ as $\underline{b}$ and it is computed as 

\begin{equation}
b(\tau) = \frac{\partial}{\partial x} Q_{\tau}(y|x) |_{x = \bar{x}}
\end{equation}
Hence b($\tau$) is essentially derivative of conditional quantile funtion for Cox's proportional hazard model evaluated at sample mean.   

###4.3.2 Kaplan-Meier estimator   
The Kaplan-Meier(product limit estimator) is the non-parametric maximum likelihood estimator of S(t), where the maximum is taken over the set of all piecewise constant survival curves with breakpoints at the event times $t_i$. It is a product of the form  
\begin{equation}
  \hat{S(t)} = \Pi_{t_{i} < t} \frac{n_{i} - d_{i}}{n_{i}}
\end{equation}
Suppose S(t) is the probability that a member from a given population will have a lifetime exceeding t. then   
$n_i$ = Number of survivors just prior to time $t_i$.($t_1$ $\leq$ $t_2$ $\leq$ ....... $\leq$ $t_N$)   
$d_i$ = Number of deaths at time $t_i$.  
In presence of censoring $n_i$ is the number of survivors minus the number of censored cases.   

------------------------------------------------------------------------------
Time unit   At risk     Censored cases     Died    Survived   K-M estimator
---------   ---------   --------------    ------  ---------- -----------------    
1            100         3                 5        95        $\frac{95}{100}$ = 0.95    

2            92          3                 10       82        $\frac{95}{100}$ *  $\frac{82}{92}$ = 0.847   

3           79           3                 15       64        0.8467* $\frac{64}{79}$ = 0.686    

4           61           3                 20       41        0.686*$\frac{41}{61}$ = 0.461    

5           38           3                 25       13        0.461*$\frac{13}{38}$ = 0.158



------------------------------------------------------------------------------

###4.3.3 The algorithm   
Kaplan-Meier estimator is used to estimate the survival function in presence of censored/uncensored observations. This algorithm generalizes the Kaplan-Meier estimator to the quantile regression setting. It makes changes in Kaplan-Meier estimator to get  
**(i)**. Recursively reweighted survival function.  
**(ii)**. Making sure that weighted gradient condition remains piecewise linear in quantile $\tau$, and this is required for simplex pivoting.   

####4.3.3.1 The new Kaplan-Meier weights   
Efron(1967) has used Kaplan-Meier estimator to redistribute the mass of each censored observations to the noncensored observations to the right.  
$$
 \begin{aligned}
 \because \widetilde{Y_{i}} &= min\{Y_{i}, C_{i} \}
 \end{aligned}
$$
$\therefore$ observations are censored if $Y_i$ > $C_i$. We redistribute the mass, P($Y_i$ > $C_i$), to observed observations above $C_i$. P($Y_i$ > $C_i$) is called **censoring probability**. Now problem turns into estimating P($Y_i$ > $C_i$), for each censored observations. From quantile regression perspective, this means finding the value $\hat{\tau_{i}}$ at which the quantile function $\underline{x_{i}^{'}}\underline{\hat{\beta(\tau)}}$, crosses $C_i$. For each censored observations if $\hat{\tau_{i}}$ is known, define  
\begin{equation}
  w_{i}(\tau) = \frac{\tau - \hat{\tau_{i}}}{1 - \hat{\tau_{i}}}
\end{equation}
for $\bigtriangleup_{i}$ = 0 and $\tau$ > $\hat{\tau_{i}}$.  
Weighted quantile regression uses weighted observations at ($x_i$, $C_i$) with weight $w_{i}(\tau)$ and ($x_i$, $+\inf$) with complementary weight (1 - $w_{i}(\tau)$).    

####4.3.3.2 Computation of $w_{i}(\tau)$ for Kaplan-Meier estimator   
Kaplan-Meier estimator is used to estimate survival function. By knowing estimate of survival function one can compute empirical quantile function as if $S_{i}(t)$ is survival function and $F_{i}(t)$ is distribution function then $S_{i}(t)$ = 1 - $F_{i}(t)$. Consider one sample problem with censoring $\widetilde{y_{i}}$ = min{$y_i$, $c_i$}. Kaplan-Meier estimator for quantile has a jump at $y_i$ for each uncensored observations. If one or more of first observations are uncensored then empirical quantile function will be just inverse of survival function. Situation will be different when first censored observation arise. If $\hat{\tau_{1}}$ is probability upto first censored observation then define $\hat{\tau_{1}}$ = $\frac{j}{n}$ for j = 1, 2, ..........., n. For example if we have observations amongst which first 4 are uncensored and $5_{th}$ one is censored(total number of observation is n = 10) then $\hat{\tau_{1}}$ = $\frac{4}{10}$ = 0.4. Now treat censored observation as two observations one observation at $c_{j}$ and other being at $\inf$ with respective weights $\frac{\tau - \hat{\tau_{1}}}{1 - \hat{\tau_{1}}}$ and $\frac{1 - \tau}{1 - \hat{\tau_{1}}}$.   
To illustrate above computation consider a sample with 10 observations having 3-censored observations. We observations x = 1, 2, 3, ......, 10; censored at x = 5, 7, 8. To get empirical distribution function using above method we proceed as follow:  
$\because$ first four observations are uncensored therefore $\hat{\tau_{1}}$ = $\frac{4}{10}$ = .4  
$\therefore$ cdf estimator at points x = 1, 2, 3, 4 are .1, .2, .3, .4 respectively. Next observation 5 is censored, we divide 5 in two new observations one at 5 with weight .4 and other at $\inf$ with weight .6. If $\hat{\tau}$ is cdf at x = 6 then  

$$
 \begin{aligned}
 \hat{\tau} &= \frac{4 + \frac{\hat{\tau} - .4}{1 - .4} + 1}{10} \\
 10 \hat{\tau} &= 5 + \frac{\hat{\tau} - .4}{.6} \\
 6 \hat{\tau} &= 3 + \hat{\tau} - 0.4 \\
 \hat{\tau} &= .52
 \end{aligned}
$$
Now x = 7, 8 both observations are censored so they have cdf estimate .52 each. x = 9 is next uncensored observation, if $\hat{\tau}$ is cdf estimate at x = 9 then   
$$
 \begin{aligned}
 \hat{\tau} &= \frac{4 + \frac{\hat{\tau} - .4}{.6} + 1 + 2 \frac{\hat{\tau} - .52}{.48} + 1} {10} \\
 \therefore \hat{\tau}  &= .76
 \end{aligned}
$$
Now cdf estimate at x = 10 will be 1.   

###4.3.3.3 Steps to compute parameters   
Let {$\hat{\tau_{j}^{*}}, j = 1, 2, 3, .......$} be the breakpoints such that quantile function is piecewise constant and let $\hat{\tau_{i}}$ be the $i^{th}$ breakpoint corresponding to a censored observation. Steps involved in censored quantile regression computation are:   
**1.** Start with first breakpoint and compute $\hat{\beta}(\tau_{1}^{*})$ by using usual method of computation of $\hat{\beta}(\tau^{*}_{1})$ in absence of censored observation. In computation of $\hat{\beta}(\tau_{1}^{*})$ whole data is used.  
**2.** For general case $\hat{\beta}(\tau)$ is obtained by minimizing 

\begin{equation}
  \sum_{i \notin K} \rho_{\tau}(Y_{i} - \underline{x_{i}^{'}} \underline{\beta}) + \sum_{i \in K} w_{i}(\tau) \rho_{\tau}(C_{i} - \underline{x_{i}^{'}} \underline{\beta}) + (1 - w_{i}(\tau)) \rho_{\tau}(Y^{*} - \underline{x_{i}^{'}} \underline{\beta})
\end{equation}
where K denotes the indices for censored observations that have previously been crossed. $Y^{*}$ is an arbitray number sufficiently large to be greater than {$\underline{x_{i}^{'}} \underline{\beta}$: $\forall$ i $\in$ K}.   
**3.** Now suppose $C_i$ > $\underline{x_{i}^{'}}\underline{\hat{\beta}}(\tau_{j}^{*})$ but $C_{i}$ < $\underline{x_{i}^{'}}\underline{\hat{\beta}}(\tau_{j+1}^{*})$, then these observations must be split into two observations, one ($x_{i}$, $c_{i}$) having weight $w_{i}(\tau)$ and another ($x_{i}$, $\inf$) having weight 1 - $w_{i}(\tau)$ where $w_{i}(\tau)$ is defined in (15). Now proceed with step 2.  
**4.** The algorithm stops when either the next breakpoint equals 1 or when only nonreweighted censored observations remain above the current solution.  

##4.4 Example on real dataset   
To illustrate censored quantile regression we will use **UIS drug study data** from **quantreg** package in R. The data has 575 observations of 18 variables. Variable description are as follow. 

------------------------------------------------------------------------------------
Variable   Description                                         Codes/Values    
--------  -----------------------------   ------------------------------------------
ID         Indentification code             1 to 628     

AGE        Age at Enrollment                Years   

BECK       Beck DepressionScore             0.000 to 54.000   

HC         Heroin/Cocaine Use During        1 = Heroin & Cocaine    

           3 Months Prior to Admission      2 = Heroin only     
                                            
                                            3 = Cocaine Only    
                                            
                                            4 = Neither Heroin nor Cocaine  
                                            
IV        History of IV Drug Use            1 = Never     
                                            
                                            2 = Previous   

NDT       Number of Prior Drug Treatments   0 to 40    

RACE      Subject's Race                    0 = White   
                                            
                                            1 = Non-White


TREAT     Treatment Randomization           0 = Short   

          Assignment                        1 = Long   

SITE     Treatment Site                     0 = A

                                            1 = B   

LEN.T     Length of Stay in Treatment        Days    

          (Admission Date to Exit Date)                           

TIME      Time to Drug Relapse              Days

          (Measured from Admission Date)    Days   

CENSOR    Event for Treating Lost to        1 = Returned to Drugs

          Follow-Up as Returned to Drugs    or Lost to Follow-Up

                                            0 = Otherwise    

Y         log of TIME                                               

ND1       Component of NDT                                         

ND2       Component of NDT                                           

LNDT                                                                

FRAC      Compliance fraction               LEN.T/90 for short trt

                                            LEN.T/180 for long trt   

IV3       Recent IV use                     1 = Yes         
 
                                            2 = No  


------------------------------------------------------------------------------------

First few rows of data looks like this:  
```{r, echo = FALSE, comment = NA}
suppressPackageStartupMessages(library(survival))
data(uis)
uisDataDim <- dim(uis)
head(uis)
noOfCensor <- sum(uis$CENSOR == 0)
```
`r noOfCensor` number of observations are censored. Let's model the logarithm of the **time to relapse** of subjects in a drug treatment program(**TIME** is dependent variable) with  
**1.** Number of prior treatments ND1, ND2.  
**2.** The treatment indicator, TREAT taking the value 1 for subjects taking the **long** course and 0 for subjects taking the **short** course.  
**3.** An indicator for prior intravenous drug use IV3.  
**4.** A compliance variable FRAC.  
**5.** Subject's race(RACE variable here).   
**6.** Interaction of subject's age and site of treatment(AGE*SITE variable here).   
The following graph(figure 4.3) is generated by using quantreg package in R. Shaded **light blue** region in the graph is the 95% confidence interval estimate of quantiles using Portnoy's method. **Dark blue** line in the plot is the point estimate of various censored quantile regression fit. **Solid black** line in the plot shows null effect(log TIME = 0), it is present in some plots only. The **red line** in the plot is estimate of conditional quantile of estimated Cox's proportional hazard model. A feature of Cox's estimates is that they must lie entirely above the horizontal line(line for which dependent variable is zero) or completely below it. Thus, covariates must either increase hazard rate or decrease it, therefore Cox's proportional hazard model forbids the possibility that treatment may increase hazard for some time and then decrease it. But in real life we can have situations where covariate will increase hazard rate for some time and then may decrease it, in such situations quantile regression approach will be advantageous to use.  

```{r, echo = FALSE, comment = NA, fig.height = 10, fig.width = 10}
fit <- crq(Surv(log(TIME), CENSOR) ~ ND1 + ND2 + IV3 +
TREAT + FRAC + RACE + AGE * SITE, data = uis, method = "Por")
Sfit <- summary(fit, 1:19/20)
PHit <- coxph(Surv(TIME, CENSOR) ~ ND1 + ND2 + IV3 +
TREAT + FRAC + RACE + AGE * SITE, data = uis)
plot(Sfit, CoxPHit = PHit)
```
**Figure 4.3**: Censored quantile regression coefficients plots for the **uis drug study** data. The solid blue line indicates the quantile regression point estimates, the lighter blue region is a pointwise 95% confidence band, and the red curve in each plot illustrates the estimated conditional quantile effect estimated for the Cox proportional hazard model.   

##4.5 Example on simulated dataset  






$$
 \begin{aligned}
 \end{aligned}
$$



\begin{equation}
\end{equation}